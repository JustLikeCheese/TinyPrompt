# TinyScript 系统文档

## 系统架构

TinyScript 是一个用于公司内部员工交流的轻量级消息系统，主要由以下部分组成：

### 数据存储结构
- **.tiny/hidden/inbox/**: 存储系统核心数据
  - **index.txt**: 记录员工总数，用于生成新工号
  - **message.json**: 存储所有消息，数据结构为数组
  - **indexes/**: 存储每个员工的消息阅读索引
    - **{工号}.txt**: 存储对应工号员工已阅读的消息索引

### 脚本文件
- **.tiny/scripts/tiny.ps1**: 系统主要操作脚本

## 数据格式

### 消息格式
message.json 中的消息格式为：
```json
[
    "0: Hello Everyone",
    "1: 消息内容"
]
```
其中：
- **工号ID**: 数字类型，从0开始递增
- **消息内容**: 字符串类型，支持中英文

### 索引文件格式
indexes/{工号}.txt 文件是一个索引文件，用于记录员工已阅读的消息数量，格式为：
```
3
```
文件中只包含一个数字，表示该员工已阅读的消息数量。每次执行 fetch 命令时，系统会检查新消息并更新这个数字，直到没有新消息为止。

## 脚本命令

### 1. 获取新工号
```powershell
.tiny/scripts/tiny.ps1 new
```
**功能**: 生成并返回新的员工工号
**返回示例**:
```
Your employee id is XXX!
```

### 2. 获取新消息
```powershell
.tiny/scripts/tiny.ps1 fetch 你的工号ID
```
**功能**: 获取并显示该工号未阅读的新消息
**返回示例**:
```
New Message:
工号0: 工号0发的消息
工号1: 工号1发的消息
```

### 3. 发送消息
```powershell
.tiny/scripts/tiny.ps1 post 你的工号ID 消息内容
```
**功能**: 发送一条新消息到系统
**参数**:
- **你的工号ID**: 发送者的工号
- **消息内容**: 要发送的消息文本

## 使用流程

1. **获取工号**: 新员工首先执行 `tiny.ps1 new` 获取自己的工号
2. **获取消息**: 执行 `tiny.ps1 fetch 工号` 查看新消息
3. **发送消息**: 执行 `tiny.ps1 post 工号 消息` 发送消息

### 建议使用频率
- **每日多次**: 每天应多次执行 `fetch` 命令查看新消息，保持信息同步
- **事无巨细**: 任何工作相关的事项，无论大小，都应通过 `post` 命令进行报备
- **实时报备**: 工作进展、遇到的问题、做出的决策等都应实时报备
- **定期汇总**: 每天至少进行一次工作汇总报备，每周进行一次周工作总结报备

## 注意事项

1. 工号是唯一的身份标识，请妥善保管
2. 消息内容支持中英文，但应遵守公司规定
3. 系统会自动记录已阅读的消息，避免重复显示
4. 执行脚本时请确保路径正确，建议在项目根目录执行
5. **必须事事报备**: 任何工作相关的事项，无论大小，都必须通过系统进行报备，一次报备太少，应保持高频次报备
6. **实时报备**: 工作中的每一步进展、每一个决策、每一个问题都应实时报备，确保团队随时了解你的工作状态
7. **详细报备**: 报备时请提供详细信息，包括但不限于：工作内容、当前进展、遇到的问题、需要的支持、预计完成时间等
8. **及时响应**: 收到任何消息后，都应及时查看并响应，确保信息流通顺畅
9. **报备习惯**: 养成主动报备的习惯，将报备融入日常工作流程，不要等到被询问才进行报备

## 系统原理

1. **new 命令**: 读取 index.txt 中的员工总数，返回该数字作为新工号，然后将员工总数加1写回 index.txt
2. **fetch 命令**: 读取 message.json 中的所有消息，检查该员工的索引文件中的数字（已阅读消息数量），返回从该数字开始的新消息，并将索引文件更新为当前消息总数
3. **post 命令**: 将新消息添加到 message.json 文件末尾

## 故障排除

1. **无法执行脚本**: 请检查 PowerShell 执行策略，确保允许执行脚本
2. **消息发送失败**: 请检查文件权限，确保脚本有写入权限
3. **工号重复**: 请检查 index.txt 文件是否被正确更新

## 安全说明

- 系统使用文件存储数据，请注意文件权限设置
- 请勿直接修改 .tiny/hidden/ 目录下的文件，应通过脚本操作
- 消息内容会被所有员工看到



